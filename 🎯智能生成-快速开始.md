# 🎯 智能训练数据生成 - 快速开始

## ⚡ 5 分钟快速上手

### 步骤 1：准备数据文件

你已经有了：`data/T_BANK_LINE_NO_ICBC_ALL.unl`

格式：`联行号|银行名称|其他字段...`

### 步骤 2：上传并生成（通过 API）

```bash
# 获取 token
TOKEN=$(curl -s -X POST "http://localhost:8000/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=testuser&password=test123" | jq -r '.access_token')

# 上传文件并生成训练样本
curl -X POST "http://localhost:8000/api/v1/bank-data/upload-and-generate" \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@data/T_BANK_LINE_NO_ICBC_ALL.unl" \
  -F "samples_per_bank=7" \
  -F "use_llm=false"
```

### 步骤 3：查看结果

```bash
# 假设返回的 dataset_id 是 10
curl "http://localhost:8000/api/v1/bank-data/generation-status/10" \
  -H "Authorization: Bearer $TOKEN"
```

### 步骤 4：使用数据集训练模型

在前端训练管理页面：
1. 选择刚生成的数据集（ID: 10）
2. 配置训练参数
3. 开始训练

## 📊 预期结果

**输入：**
- 177,316 个银行记录

**输出：**
- 1,241,212 个训练样本
- 每个银行 7 种不同问法

**生成时间：**
- 小规模测试（100 个银行）：~1 秒
- 完整数据集：~30 分钟

## 🎯 生成示例

**原始数据：**
```
102100099996|中国工商银行股份有限公司北京市分行|...
```

**自动生成 7 个样本：**
1. Q: "中国工商银行股份有限公司北京市分行"
   A: "中国工商银行股份有限公司北京市分行: 102100099996"

2. Q: "中国工商银行北京市分行"
   A: "中国工商银行股份有限公司北京市分行: 102100099996"

3. Q: "工商银行北京市"
   A: "中国工商银行股份有限公司北京市分行: 102100099996"

4. Q: "市工商银行北京"
   A: "中国工商银行股份有限公司北京市分行: 102100099996"

5. Q: "中国工商银行股份有限公司北京市分行的联行号"
   A: "中国工商银行股份有限公司北京市分行: 102100099996"

6. Q: "中国工商银行北京市分行联行号是多少"
   A: "中国工商银行股份有限公司北京市分行: 102100099996"

7. Q: "工行北京市"
   A: "中国工商银行股份有限公司北京市分行: 102100099996"

## 🔧 参数说明

### samples_per_bank
- **默认值：** 7
- **范围：** 3-10
- **说明：** 每个银行生成的样本数量
- **建议：** 7（平衡质量和数量）

### use_llm
- **默认值：** false
- **选项：** true/false
- **说明：** 是否使用大模型生成（更自然但更慢）
- **建议：** false（规则生成已经很好）

## 💡 最佳实践

### 1. 先测试小规模

```bash
# 创建测试文件（前 100 行）
head -100 data/T_BANK_LINE_NO_ICBC_ALL.unl > test_banks.unl

# 测试生成
curl -X POST "http://localhost:8000/api/v1/bank-data/upload-and-generate" \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@test_banks.unl" \
  -F "samples_per_bank=7"
```

### 2. 验证生成质量

查看生成的样本是否符合预期：
- 问法是否多样化
- 答案格式是否正确
- 是否覆盖了常见查询方式

### 3. 再生成完整数据集

确认质量后，生成完整数据集：
```bash
curl -X POST "http://localhost:8000/api/v1/bank-data/upload-and-generate" \
  -H "Authorization: Bearer $TOKEN" \
  -F "file=@data/T_BANK_LINE_NO_ICBC_ALL.unl" \
  -F "samples_per_bank=7"
```

### 4. 训练并验证

使用生成的数据集训练模型，对比准确率提升。

## 🚨 注意事项

1. **文件格式：** 必须是 `.unl` 格式，使用 `|` 分隔
2. **编码：** 文件必须是 UTF-8 编码
3. **联行号：** 必须是 12 位数字
4. **生成时间：** 完整数据集需要约 30 分钟
5. **磁盘空间：** 确保有足够空间存储样本（约 500MB）

## 📞 故障排查

### 问题 1：上传失败

**可能原因：**
- 文件格式不正确
- 文件编码问题
- 文件过大

**解决方案：**
```bash
# 检查文件格式
head -5 data/T_BANK_LINE_NO_ICBC_ALL.unl

# 检查编码
file -I data/T_BANK_LINE_NO_ICBC_ALL.unl
```

### 问题 2：生成速度慢

**可能原因：**
- 使用了 LLM 模式
- 数据量太大

**解决方案：**
- 使用规则模式（`use_llm=false`）
- 分批处理

### 问题 3：样本质量不佳

**可能原因：**
- 银行名称格式特殊
- 规则不够完善

**解决方案：**
- 查看生成的样本示例
- 调整生成参数
- 考虑使用 LLM 模式

## ✅ 验证成功

生成完成后，你应该看到：

```json
{
  "success": true,
  "message": "成功生成训练数据集",
  "dataset_id": 10,
  "total_banks": 177316,
  "total_samples": 1241212,
  "samples_per_bank": 7
}
```

## 🎯 下一步

1. ✅ 数据集已生成
2. ⏳ 使用数据集训练模型
3. ⏳ 测试模型准确率
4. ⏳ 对比提升效果

---

**准备好了吗？** 开始生成你的训练数据集吧！ 🚀
