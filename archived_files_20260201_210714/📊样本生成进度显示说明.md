# 📊 样本生成进度显示说明

## 当前状态

### ✅ 已有的功能

前端界面已经包含了完整的进度显示组件：

1. **生成任务Tab页** - 显示所有历史任务
2. **任务状态监控** - 实时显示任务进度
3. **进度条显示** - 可视化进度百分比
4. **详细统计** - 显示处理数量、生成样本数、错误数
5. **日志查看** - 查看任务执行日志

### 📍 当前实现方式

**同步生成模式**：
- 点击"开始生成样本"后，前端会等待后端完成所有生成
- 生成过程中会显示"正在生成样本，请稍候..."的加载提示
- 生成完成后，会弹出详细的统计信息

**优点**：
- ✅ 实现简单，不需要轮询
- ✅ 立即看到完整结果
- ✅ 不需要额外的任务管理

**缺点**：
- ❌ 无法看到实时进度
- ❌ 大批量生成时需要等待较长时间
- ❌ 浏览器可能超时（对于非常大的数据集）

## 🎯 如何查看生成结果

### 方法1: 等待生成完成（当前方式）

1. **配置生成参数**
   - 进入"样本管理" -> "样本管理"
   - 点击"生成样本"按钮
   - 切换到"生成配置"Tab

2. **开始生成**
   - 填写所有必要参数
   - 点击"开始生成样本"
   - 等待加载提示消失

3. **查看结果**
   - 生成完成后会弹出统计信息
   - 显示总计生成数、训练集、验证集、测试集数量
   - 如有错误，会显示错误信息

### 方法2: 查看生成任务（历史记录）

1. **切换到生成任务Tab**
   - 在样本生成弹窗中
   - 点击"生成任务"Tab

2. **查看任务列表**
   - 显示所有历史生成任务
   - 包含任务ID、数据集、状态、进度、生成样本数、创建时间

3. **查看任务详情**
   - 点击任务的"查看"按钮
   - 可以看到任务的详细信息（如果是异步任务）

## 💡 生成建议

### 小批量测试（推荐）

**配置**：
```
- 记录数策略: 自定义数量
- 自定义记录数: 10-50
- LLM提供商: local（最快）
- 问题类型: 选择1-2种
```

**预计时间**：
- 本地模板: 1-5秒
- LLM API: 10-100秒

### 中等批量生成

**配置**：
```
- 记录数策略: 自定义数量
- 自定义记录数: 100-500
- LLM提供商: qwen/deepseek/volces
- 问题类型: 全选
```

**预计时间**：
- 本地模板: 5-30秒
- LLM API: 2-10分钟

### 大批量生成

**配置**：
```
- 记录数策略: 全部记录 或 按百分比
- LLM提供商: local（推荐）
- 问题类型: 全选
```

**预计时间**：
- 本地模板: 30秒-2分钟
- LLM API: 10-60分钟（不推荐）

## 🔍 监控生成过程

### 查看后端日志

如果想实时监控生成进度，可以查看后端日志：

```bash
# 实时查看日志
tail -f mvp/logs/app_2026-02-01.log

# 或者查看backend.log
tail -f mvp/backend.log
```

**日志中会显示**：
- 每个样本的生成进度
- API调用情况
- 成功/失败统计
- 错误信息

### 日志示例

```
2026-02-01 20:20:15 | INFO | 生成问答对 - 记录ID: 123, 类型: exact, 尝试: 1/3
2026-02-01 20:20:16 | INFO | 问答对生成成功 - 记录ID: 123, 类型: exact, 耗时: 1.23秒
2026-02-01 20:20:16 | INFO | 本地生成问答对成功 - 记录ID: 124, 类型: fuzzy
```

## 🚀 未来改进方向

### 异步任务模式（可选）

如果需要处理非常大的数据集（10万+记录），可以实现异步任务模式：

**优点**：
- ✅ 实时进度显示
- ✅ 可以取消任务
- ✅ 不会阻塞浏览器
- ✅ 支持后台运行

**实现方式**：
1. 后端已有异步任务API (`/api/sample-generation/*`)
2. 需要修改前端调用异步API
3. 使用轮询或WebSocket更新进度

**是否需要**：
- 如果数据集 < 10000条记录：**不需要**，当前同步方式足够
- 如果数据集 > 10000条记录：**建议实现**异步模式

## 📝 当前生成流程

### 1. 用户操作
```
选择数据集 → 配置参数 → 点击生成 → 等待完成 → 查看结果
```

### 2. 后端处理
```
接收请求 → 验证参数 → 遍历记录 → 生成QA对 → 保存数据库 → 返回结果
```

### 3. 进度反馈
```
- 开始: 显示"正在生成样本，请稍候..."
- 进行中: 后端日志记录进度
- 完成: 弹出统计信息弹窗
```

## 🎨 界面说明

### 生成配置Tab

**位置**：样本管理 -> 样本管理 -> 生成样本 -> 生成配置

**功能**：
- 选择数据集
- 配置挑选策略
- 选择LLM提供商
- 设置问题类型
- 配置生成参数

### 生成任务Tab

**位置**：样本管理 -> 样本管理 -> 生成样本 -> 生成任务

**功能**：
- 查看所有历史任务
- 显示任务状态（等待中/运行中/已完成/失败）
- 显示进度百分比
- 显示生成样本数
- 查看任务详情
- 取消运行中的任务（异步模式）

### 任务详情弹窗

**触发**：点击任务的"查看"按钮

**显示内容**：
- 任务状态
- 总体进度（进度条）
- 当前步骤
- 处理进度（已处理/总数）
- 生成样本数
- 错误数量
- 预计完成时间
- 执行日志

## 💬 常见问题

### Q: 为什么看不到实时进度？

A: 当前使用同步生成模式，生成过程中前端会等待后端完成。你可以：
1. 查看后端日志监控进度
2. 使用小批量测试（10-50条）快速验证
3. 如需处理大数据集，可以考虑实现异步模式

### Q: 生成需要多长时间？

A: 取决于：
- **记录数量**: 10条 vs 10000条
- **LLM提供商**: 本地模板（最快）vs API调用（较慢）
- **问题类型数量**: 1种 vs 4种
- **网络状况**: API调用受网络影响

**参考时间**：
- 本地模板 + 100条 + 4种类型 = 约10秒
- Qwen API + 100条 + 4种类型 = 约5-10分钟

### Q: 如何加快生成速度？

A: 
1. **使用本地模板** - 最快，无需API调用
2. **减少记录数** - 使用自定义数量或百分比
3. **减少问题类型** - 只选择需要的类型
4. **分批生成** - 多次小批量生成而不是一次大批量

### Q: 生成失败怎么办？

A: 
1. 查看错误提示信息
2. 检查后端日志: `tail -100 mvp/logs/app_2026-02-01.log`
3. 确认API密钥配置（如使用LLM API）
4. 尝试使用本地模板生成器
5. 减少生成数量重试

## 📊 生成统计示例

### 成功生成

```
✅ 样本生成完成

总计生成: 687 个样本
📊 训练集: 548
📊 验证集: 67
📊 测试集: 72

⚠️ 部分记录生成失败:
- 2 QA pairs failed to generate
- Record 4011 (（CIPS专用）中国银行（秘鲁）有限公司): 1 failures
```

### 任务列表

| 任务ID | 数据集 | 状态 | 进度 | 生成样本数 | 创建时间 |
|--------|--------|------|------|-----------|----------|
| 12ab34cd... | T_BANK_LINE_NO_ICBC_ALL.unl | 已完成 | 100% | 687 | 2026-02-01 20:20:15 |
| 56ef78gh... | test_data.csv | 运行中 | 45% | 234 | 2026-02-01 20:25:30 |

## 🎯 总结

**当前方式**：
- ✅ 简单直接，适合中小规模数据集
- ✅ 立即看到完整结果
- ✅ 无需额外配置

**查看进度**：
- 方法1: 等待生成完成，查看统计弹窗
- 方法2: 查看后端日志实时监控
- 方法3: 使用小批量测试快速验证

**建议**：
- 小批量测试: 10-50条，使用本地模板
- 正式生成: 根据需求选择合适的策略
- 大数据集: 考虑分批生成或实现异步模式

---

**文档更新时间**: 2026-02-01  
**适用版本**: v1.0.0
