# 系统完整验证指南

## 验证时间
2026-01-19

## 系统访问信息

### 服务地址
- **前端**: http://localhost:3000
- **后端**: http://localhost:8000
- **API文档**: http://localhost:8000/docs

### 登录凭证
```
用户名: admin
密码: admin123
```

⚠️ **重要提示**: 密码是 `admin123`，不是 `admin@123456`！

---

## 快速验证步骤

### 1. 检查服务状态

```bash
# 检查后端服务
ps aux | grep uvicorn

# 检查前端服务
lsof -i :3000

# 检查后端健康状态
curl http://localhost:8000/health
```

**预期输出**:
```json
{
  "status": "healthy",
  "app": "联行号检索模型训练验证系统",
  "version": "1.0.0"
}
```

### 2. 测试登录API

```bash
# 使用正确的密码登录
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin&password=admin123"
```

**预期输出**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer"
}
```

### 3. 访问前端系统

1. 打开浏览器访问: http://localhost:3000
2. 输入用户名: `admin`
3. 输入密码: `admin123`
4. 点击"登录"按钮

**预期结果**: 成功登录，跳转到系统首页

---

## 功能模块验证

### 1. 系统首页 (Dashboard)
- [ ] 显示系统概览信息
- [ ] 显示数据集统计
- [ ] 显示训练任务统计
- [ ] 显示最近活动

### 2. 数据管理
- [ ] 查看数据集列表
- [ ] 上传新数据集（CSV文件）
- [ ] 预览数据集内容
- [ ] 删除数据集
- [ ] 数据验证（重复检测）

### 3. 训练管理
- [ ] 查看训练任务列表
- [ ] 创建新训练任务
- [ ] 选择模型（Qwen2.5-0.5B等）
- [ ] 配置LoRA参数
- [ ] 查看训练进度
- [ ] 停止训练任务

### 4. 训练监控
- [ ] 查看训练任务详情
- [ ] 实时进度显示
- [ ] Loss曲线展示
- [ ] 删除训练任务（单个）
- [ ] 批量删除训练任务
- [ ] 刷新任务列表

### 5. 问答测试
- [ ] 输入问题进行查询
- [ ] 查看模型回答
- [ ] 查看相似问答对
- [ ] 评估回答质量

### 6. 用户管理（管理员）
- [ ] 查看用户列表
- [ ] 创建新用户
- [ ] 编辑用户信息
- [ ] 删除用户
- [ ] 修改用户角色

### 7. 系统设置（管理员）
- [ ] 查看系统日志
- [ ] 按级别筛选日志
- [ ] 查看日志文件列表
- [ ] 查看系统信息

---

## 详细验证流程

### 场景1: 数据上传和训练

#### 步骤1: 上传数据集
1. 点击"数据管理"菜单
2. 点击"上传数据集"按钮
3. 选择CSV文件（包含bank_code和bank_name列）
4. 填写数据集名称和描述
5. 点击"上传"

**验证点**:
- 上传进度显示
- 上传成功提示
- 数据集出现在列表中
- 记录数正确

#### 步骤2: 预览数据
1. 在数据集列表中找到刚上传的数据集
2. 点击"预览"按钮
3. 查看数据内容

**验证点**:
- 数据正确显示
- 列名正确（bank_code, bank_name）
- 数据格式正确

#### 步骤3: 生成QA对
1. 点击"生成QA对"按钮
2. 选择生成数量（如100条）
3. 等待生成完成

**验证点**:
- 生成进度显示
- 生成成功提示
- QA对数量正确

#### 步骤4: 创建训练任务
1. 点击"训练管理"菜单
2. 点击"创建训练任务"按钮
3. 选择数据集
4. 选择模型: Qwen/Qwen2.5-0.5B
5. 配置参数:
   - LoRA Rank: 8
   - LoRA Alpha: 16
   - 学习率: 0.0002
   - 训练轮数: 3
   - 批次大小: 1
6. 点击"创建"

**验证点**:
- 任务创建成功
- 任务状态为"pending"或"running"
- 任务出现在列表中

#### 步骤5: 监控训练
1. 点击"训练监控"菜单
2. 找到刚创建的训练任务
3. 观察训练进度

**验证点**:
- 进度条实时更新
- Epoch数增加
- Loss值下降
- 状态变化（pending → running → completed）

#### 步骤6: 测试模型
1. 等待训练完成
2. 点击"问答测试"菜单
3. 输入问题（如"工商银行北京分行"）
4. 点击"查询"

**验证点**:
- 返回相关答案
- 显示联行号
- 显示相似问答对

---

### 场景2: 训练任务管理

#### 删除单个任务
1. 进入"训练监控"页面
2. 找到要删除的任务
3. 点击"删除"按钮
4. 确认删除

**验证点**:
- 删除确认对话框
- 删除成功提示
- 任务从列表中消失
- 刷新后任务不再出现

#### 批量删除任务
1. 进入"训练监控"页面
2. 勾选多个任务（非运行中的）
3. 点击"批量删除"按钮
4. 确认删除

**验证点**:
- 显示选中任务数量
- 删除确认对话框
- 批量删除成功提示
- 所有选中任务消失
- 刷新后任务不再出现

#### 停止训练任务
1. 找到正在运行的任务
2. 点击"停止"按钮
3. 确认停止

**验证点**:
- 停止确认对话框
- 任务状态变为"stopped"
- 进度不再更新

---

### 场景3: 用户管理（管理员）

#### 创建新用户
1. 点击"用户管理"菜单
2. 点击"创建用户"按钮
3. 填写信息:
   - 用户名: testuser
   - 邮箱: test@example.com
   - 密码: test123456
   - 角色: user
4. 点击"创建"

**验证点**:
- 创建成功提示
- 用户出现在列表中
- 用户信息正确

#### 编辑用户
1. 找到刚创建的用户
2. 点击"编辑"按钮
3. 修改邮箱或角色
4. 点击"保存"

**验证点**:
- 修改成功提示
- 用户信息更新

#### 删除用户
1. 找到测试用户
2. 点击"删除"按钮
3. 确认删除

**验证点**:
- 删除确认对话框
- 删除成功提示
- 用户从列表中消失

---

### 场景4: 系统日志查看（管理员）

#### 查看所有日志
1. 点击"系统设置"菜单
2. 查看系统日志表格

**验证点**:
- 日志列表显示
- 时间、级别、模块、消息列
- 分页控件

#### 按级别筛选
1. 选择日志级别（如ERROR）
2. 点击"刷新"

**验证点**:
- 只显示ERROR级别日志
- 日志数量变化

#### 查看日志文件
1. 查看右侧日志文件列表

**验证点**:
- 显示多个日志文件
- 文件名格式: app_YYYY-MM-DD.log
- 按日期排序

---

## 常见问题排查

### 问题1: 登录失败 - "Incorrect username or password"

**原因**: 密码输入错误

**解决方案**:
1. 确认密码是 `admin123`（不是 `admin@123456`）
2. 检查用户名是否正确（`admin`）
3. 确保没有多余的空格

**验证命令**:
```bash
# 测试正确的密码
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=admin&password=admin123"
```

### 问题2: 系统设置页面显示 "Not Found"

**原因**: 后端API路由配置错误（已修复）

**解决方案**:
1. 确认后端代码已更新
2. 重启后端服务
3. 清除浏览器缓存

**验证命令**:
```bash
# 测试日志API
TOKEN="<your_token>"
curl -X GET "http://localhost:8000/api/v1/logs?page=1&page_size=10" \
  -H "Authorization: Bearer $TOKEN"
```

### 问题3: 训练任务删除后刷新又出现

**原因**: 前端只删除了本地状态，没有调用后端API（已修复）

**解决方案**:
1. 确认前端代码已更新
2. 使用POST方法调用删除API
3. 刷新页面验证

### 问题4: 前端无法连接后端

**原因**: CORS配置或后端服务未启动

**解决方案**:
```bash
# 1. 检查后端服务
ps aux | grep uvicorn

# 2. 检查后端健康状态
curl http://localhost:8000/health

# 3. 检查CORS配置
# 确认 mvp/app/core/config.py 中 CORS_ORIGINS 包含 http://localhost:3000
```

### 问题5: 模型训练失败

**原因**: 内存不足或模型配置错误

**解决方案**:
1. 使用较小的模型（Qwen2.5-0.5B）
2. 减小批次大小（batch_size=1）
3. 减少训练轮数（epochs=3）
4. 检查日志查看详细错误

---

## 性能基准

### 训练性能
- **模型**: Qwen2.5-0.5B
- **数据集**: 100条QA对
- **配置**: LoRA r=8, batch_size=1, epochs=3
- **设备**: CPU (Mac)
- **预期时间**: 10-20分钟

### API响应时间
- **登录**: < 500ms
- **数据上传**: 取决于文件大小
- **QA生成**: 100条约1-2分钟
- **日志查询**: < 200ms

---

## 验证清单

### 基础功能
- [ ] 后端服务运行正常
- [ ] 前端服务运行正常
- [ ] 登录功能正常（admin/admin123）
- [ ] 退出登录功能正常

### 数据管理
- [ ] 数据集上传
- [ ] 数据集预览
- [ ] 数据集删除
- [ ] QA对生成
- [ ] 重复检测

### 训练管理
- [ ] 创建训练任务
- [ ] 查看训练列表
- [ ] 查看训练详情
- [ ] 停止训练任务
- [ ] 模型选择（5个模型）

### 训练监控
- [ ] 实时进度显示
- [ ] Loss曲线
- [ ] 删除单个任务
- [ ] 批量删除任务
- [ ] 刷新功能

### 问答测试
- [ ] 输入问题查询
- [ ] 查看模型回答
- [ ] 查看相似问答对

### 用户管理
- [ ] 查看用户列表
- [ ] 创建用户
- [ ] 编辑用户
- [ ] 删除用户

### 系统设置
- [ ] 查看系统日志
- [ ] 日志级别筛选
- [ ] 查看日志文件列表
- [ ] 查看系统信息

---

## 总结

✅ **系统已完善并可验证！**

**核心功能**:
1. 用户认证和权限管理
2. 数据集上传和管理
3. QA对自动生成
4. 模型训练（支持5种模型）
5. 训练监控和管理
6. 问答测试
7. 系统日志查看

**关键修复**:
1. 登录密码确认: admin123
2. 系统设置API路由修复
3. 训练任务删除功能完善
4. 模型支持验证（5个模型全部支持）

**访问信息**:
- 前端: http://localhost:3000
- 后端: http://localhost:8000
- 用户: admin / admin123

系统现在可以完整验证所有功能！
