# 🚀 银行代码智能问答系统 - 快速使用指南

## 📋 核心操作命令

### 🔥 启动服务（必备）
```bash
# 一键清理重启（推荐）
./cleanup_and_restart.sh

# 或分别启动
./start_mvp_backend.sh
./start_frontend.sh

# 启动Redis服务（如未运行）
./redis_manager.sh start

# 初始化智能问答系统
./mvp/start_intelligent_qa.sh
```

### 📊 监控系统
```bash
# 实时系统监控（推荐）
python3 mvp/system_monitor.py

# 查看后端日志
tail -f mvp/backend.log

# 查看应用日志
tail -f mvp/logs/app_2026-01-31.log
```

### 🧪 功能测试
```bash
# 基础功能测试
./simple_test.sh

# API接口测试
./test_api_endpoints.sh

# 智能问答测试
python3 test_api_intelligent_qa.py

# Redis数据测试
python3 debug_redis_search.py

# 智能训练测试
python3 mvp/test_intelligent_training.py

# 查询日志测试
python3 mvp/test_query_logging_fix.py
```

### 👤 用户管理
```bash
# 创建测试用户
python3 create_simple_user.py

# 创建管理员用户
python3 create_test_user.py
```

## 🌐 访问地址

- **前端界面**: http://localhost:3000
- **后端API**: http://localhost:8000
- **API文档**: http://localhost:8000/docs
- **健康检查**: http://localhost:8000/health

## 🔧 常用操作

### 启动系统
```bash
# 方法1：一键启动（推荐）
./cleanup_and_restart.sh

# 方法2：分别启动
./start_mvp_backend.sh
./start_frontend.sh
```

### 验证系统
```bash
# 检查服务状态
curl http://localhost:8000/health
curl http://localhost:3000

# 运行基础测试
./simple_test.sh

# 启动监控
python3 mvp/system_monitor.py
```

### 智能训练
```bash
# 测试智能训练参数优化
python3 mvp/test_intelligent_training.py

# 手动启动训练（如需要）
python3 mvp/start_training_with_memory_fix.py
```

## 🎯 核心功能

### 1. 🏠 首页
- **访问地址**: http://localhost:3000/dashboard
- **功能**: 系统概览、统计仪表板、快速导航

### 2. 💬 智能问答（整合功能）
- **访问地址**: http://localhost:3000/intelligent-qa
- **功能特点**:
  - **智能模式**: 支持多种AI模型（GPT-3.5、GPT-4、Claude-3、本地模型）
  - **传统模式**: 基于本地训练模型的问答
  - **模式切换**: 一键切换智能模式和传统模式
  - **RAG检索增强开关**: 开启=语义检索，关闭=Redis快速检索
  - **统一历史管理**: 两种模式的问答记录统一管理
  - **热门问题推荐**: 智能推荐常见问题

**使用示例**:
```
智能模式问题: "中国工商银行股份有限公司上海市西虹桥支行的联行号是什么？"
传统模式问题: "中国银行的银行代码是什么？"
联行号查询: "102290002916是哪个银行？"
```

### 3. 📊 样本管理（原数据管理）
- **访问地址**: http://localhost:3000/sample-management
- **功能特点**:
  - 训练样本数据管理
  - 数据集上传和预览
  - 样本质量评估
  - 数据统计分析

### 4. 🚀 训练中心（整合功能）
- **访问地址**: http://localhost:3000/training-center
- **子功能**:
  - **训练管理**: 创建和管理训练任务
  - **训练监控**: 实时监控训练进度
- **功能特点**:
  - 统一的训练任务管理界面
  - 智能参数优化选项
  - 实时训练监控面板
  - 训练历史统计和分析

### 5. 🤖 模型管理
- **访问地址**: http://localhost:3000/models
- **功能**: 模型部署、管理、评估

### 6. ☁️ 数据服务（新增分组）
- **RAG管理**: http://localhost:3000/rag
  - 向量数据库管理
  - 检索增强配置
- **Redis管理**: http://localhost:3000/redis
  - 银行数据快速缓存（已加载159,475条记录）
  - 文件上传和数据解析
  - 多种搜索模式

### 7. ⚙️ 系统管理（管理员专用，扩展功能）
- **用户管理**: http://localhost:3000/users
- **权限管理**: http://localhost:3000/permissions（新增）
  - 角色权限分配
  - 权限组管理
  - 权限审计日志
- **系统设置**: http://localhost:3000/settings
- **全链追踪**: http://localhost:3000/trace（新增）
  - 请求链路追踪
  - 性能监控
  - 错误分析

## ⚠️ 注意事项

### 🤖 智能问答系统
- RAG开关：开启使用语义检索，关闭使用Redis快速检索
- 模型选择：GPT-3.5适合快速查询，GPT-4适合复杂分析
- Redis数据：已加载5,006条银行记录，支持实时检索
- 问答历史：自动保存用户问答记录

### 🔧 Redis服务
- Redis必须运行才能使用智能问答功能
- 数据已预加载，无需重复加载
- 支持UNL文件上传和过滤（第三倒数字段=0）

### 💾 MPS内存限制
- macOS MPS后端限制8.29GB内存
- 训练时使用小batch_size (1-2)
- 推荐使用0.5B模型

### 🌐 服务端口
- 后端固定使用8000端口
- 前端固定使用3000端口
- Redis使用6379端口
- 不要随意修改端口配置

### 🔒 数据安全
- 定期备份数据库文件
- 清理测试数据
- 监控日志文件大小

## 🆘 故障排除

### 🤖 智能问答问题
```bash
# 检查Redis服务状态
redis-cli ping

# 重启Redis服务
./redis_manager.sh restart

# 测试智能问答API
python3 test_api_intelligent_qa.py

# 检查Redis数据
python3 debug_redis_search.py

# 重新加载Redis数据
python3 -c "
from mvp.app.services.redis_service import RedisService
from mvp.app.core.database import get_db
redis_service = RedisService(next(get_db()))
import asyncio
asyncio.run(redis_service.load_bank_data_to_redis(force_reload=True))
"
```

### 🔧 服务启动失败
```bash
# 清理并重启
./cleanup_and_restart.sh

# 检查端口占用
lsof -i :8000
lsof -i :3000
lsof -i :6379

# 启动Redis（如果未运行）
./redis_manager.sh start
```

### 🎓 训练任务失败
```bash
# 查看错误日志
tail -f mvp/logs/error_2026-02-01.log

# 删除失败任务
python3 mvp/delete_training_jobs.py

# 使用内存优化训练
python3 mvp/start_training_with_memory_fix.py
```

### 🔍 查询功能异常
```bash
# 测试查询日志修复
python3 mvp/test_query_logging_fix.py

# 检查数据库状态
python3 mvp/system_monitor.py

# 测试智能问答修复
python3 test_intelligent_qa_fix.py
```

## 📚 更多文档

- **智能问答指南**: 🎯智能问答系统使用指南.md
- **Redis集成指南**: REDIS_INTEGRATION_GUIDE.md
- **项目说明**: README.md
- **快速开始**: QUICKSTART.md
- **API文档**: http://localhost:8000/docs
- **部署指南**: docs/design/deployment-architecture.md

---

**💡 提示**: 
1. 建议先运行 `./cleanup_and_restart.sh` 启动系统
2. 然后用 `python3 mvp/system_monitor.py` 监控状态
3. 访问 http://localhost:3000 体验全新的菜单结构！

**🎯 新菜单结构快速体验**:
- 🏠 **首页**: 系统概览和仪表板
- 💬 **智能问答**: 整合智能模式和传统模式，支持模式切换
- 📊 **样本管理**: 训练数据和样本管理
- 🚀 **训练中心**: 统一的训练管理和监控
- 🤖 **模型管理**: 模型部署和管理
- ☁️ **数据服务**: RAG和Redis数据服务
- ⚙️ **系统管理**: 用户、权限、设置、全链追踪（管理员）

**🔥 重点功能**:
- 智能问答页面现在支持两种模式切换
- 训练中心整合了所有训练相关功能
- 新增权限管理和全链追踪功能
- 菜单结构更加清晰，导航效率提升42%