# 🎯 智能问答系统使用指南

## 🚀 快速开始

### 1. 启动系统

```bash
# 启动Redis服务
redis-server

# 启动后端服务
cd mvp
python -m app.main

# 启动前端服务（另一个终端）
cd frontend
npm start
```

### 2. 访问地址

- **前端界面**: http://localhost:3000
- **后端API**: http://localhost:8000
- **API文档**: http://localhost:8000/docs

### 3. 登录凭证

- **管理员**: admin / admin123456
- **普通用户**: testuser / test123456

## 📋 功能模块

### 1. Redis数据管理

#### 访问路径
- 前端: 登录后点击"Redis管理"菜单
- API: `/api/redis/*`

#### 主要功能
- **数据加载**: 将银行数据从数据库加载到Redis
- **数据统计**: 查看Redis中的数据统计信息
- **数据搜索**: 在Redis中搜索银行信息
- **健康检查**: 检查Redis连接状态
- **数据清理**: 清空Redis中的数据

#### API示例
```bash
# 加载数据到Redis
curl -X POST "http://localhost:8000/api/redis/load-data" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 搜索银行信息
curl -X GET "http://localhost:8000/api/redis/search?query=工商银行&limit=5" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 检查Redis健康状态
curl -X GET "http://localhost:8000/api/redis/health" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 2. 智能问答系统

#### 访问路径
- 前端: 登录后点击"智能问答"菜单
- API: `/api/intelligent-qa/*`

#### 主要功能
- **智能问答**: 基于小模型和Redis的智能问答
- **模型选择**: 支持多种AI模型（GPT、Claude、本地模型）
- **检索策略**: 支持多种检索策略
- **问答历史**: 保存和查看问答历史记录

#### 检索策略说明

| 策略 | 描述 | 适用场景 | 响应速度 |
|------|------|----------|----------|
| `redis_only` | 仅使用Redis检索 | 精确匹配查询 | 极快（毫秒级） |
| `rag_only` | 仅使用RAG检索 | 语义相似度查询 | 较慢（秒级） |
| `hybrid` | 混合检索 | 综合查询 | 中等 |
| `intelligent` | 智能选择 | 自动选择最佳策略 | 自适应 |

#### API示例
```bash
# 智能问答
curl -X POST "http://localhost:8000/api/intelligent-qa/ask" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "question": "工商银行西虹桥支行的联行号是什么？",
    "retrieval_strategy": "redis_only"
  }'

# 获取可用模型
curl -X GET "http://localhost:8000/api/intelligent-qa/models" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## 🎯 使用场景

### 1. 精确银行查询
**问题**: "中国工商银行股份有限公司上海市西虹桥支行"
**策略**: `redis_only`
**结果**: 快速返回准确的联行号信息

### 2. 模糊银行查询
**问题**: "福州有哪些工商银行支行？"
**策略**: `intelligent`
**结果**: 返回福州地区的工商银行支行列表

### 3. 联行号反查
**问题**: "102290002916是哪个银行？"
**策略**: `redis_only`
**结果**: 返回对应的银行信息

### 4. 银行业务咨询
**问题**: "什么是联行号？"
**策略**: `rag_only`
**结果**: 基于知识库的详细解释

## ⚙️ 配置说明

### 环境变量配置 (mvp/.env)

```bash
# Redis配置
REDIS_URL=redis://localhost:6379/0
REDIS_CONNECTION_TIMEOUT=10
REDIS_BATCH_SIZE=1000

# 智能问答配置
QA_DEFAULT_RETRIEVAL_STRATEGY=intelligent
QA_MAX_CONTEXT_RESULTS=5
QA_ENABLE_HISTORY=true

# 模型配置（可选）
OPENAI_API_KEY=your_openai_api_key_here
ANTHROPIC_API_KEY=your_anthropic_api_key_here
LOCAL_MODEL_NAME=microsoft/DialoGPT-medium
```

### 模型配置

#### 支持的模型类型
- **OpenAI**: gpt-3.5-turbo, gpt-4
- **Anthropic**: claude-3-sonnet, claude-3-haiku
- **本地模型**: microsoft/DialoGPT-medium

#### 模型选择建议
- **快速响应**: 使用本地模型或gpt-3.5-turbo
- **高质量答案**: 使用gpt-4或claude-3-sonnet
- **成本控制**: 使用本地模型

## 🔧 故障排除

### 1. Redis连接失败
```bash
# 检查Redis是否运行
redis-cli ping

# 启动Redis服务
redis-server
```

### 2. 数据加载失败
```bash
# 检查数据库文件
ls -la mvp/data/bank_code.db

# 重新初始化数据库
cd mvp && python scripts/init_db.py
```

### 3. 智能问答无响应
```bash
# 检查模型配置
curl -X GET "http://localhost:8000/api/intelligent-qa/models" \
  -H "Authorization: Bearer YOUR_TOKEN"

# 检查Redis状态
curl -X GET "http://localhost:8000/api/redis/health" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 4. 前端无法访问
```bash
# 检查前端服务
curl http://localhost:3000

# 重启前端服务
cd frontend && npm start
```

## 📊 性能优化

### 1. Redis优化
- 定期清理过期数据
- 调整批处理大小
- 监控内存使用

### 2. 问答优化
- 选择合适的检索策略
- 启用答案缓存
- 调整上下文结果数量

### 3. 模型优化
- 根据需求选择模型
- 调整生成参数
- 使用本地模型减少延迟

## 🎉 最佳实践

### 1. 数据管理
- 定期备份Redis数据
- 监控数据同步状态
- 及时更新银行信息

### 2. 问答使用
- 使用具体的银行名称
- 选择合适的检索策略
- 查看问答历史记录

### 3. 系统维护
- 定期检查系统健康状态
- 监控API响应时间
- 及时处理错误日志

---

**系统版本**: MVP v1.0  
**更新时间**: 2026年2月1日  
**技术支持**: 智能问答系统开发团队